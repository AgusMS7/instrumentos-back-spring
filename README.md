# üéµ Sistema de Instrumentos Musicales - Backend API

Una API REST completa desarrollada con **Spring Boot 3** para la gesti√≥n integral de instrumentos musicales, categor√≠as, im√°genes y **sistema de pedidos**.

## üìã Caracter√≠sticas Implementadas

- ‚úÖ **CRUD completo** de instrumentos, categor√≠as y **pedidos**
- ‚úÖ **Sistema de im√°genes** con upload y gesti√≥n avanzada
- ‚úÖ **Sistema de pedidos** con m√∫ltiples instrumentos por pedido
- ‚úÖ **Paginaci√≥n y ordenamiento** para instrumentos
- ‚úÖ **B√∫squeda** por nombre de instrumento y categor√≠a
- ‚úÖ **B√∫squeda de pedidos** por fecha
- ‚úÖ **Validaciones** robustas de datos y relaciones
- ‚úÖ **Manejo de errores** estructurado con c√≥digos HTTP apropiados
- ‚úÖ **Logging** detallado para debugging y monitoreo
- ‚úÖ **CORS** configurado para desarrollo frontend
- ‚úÖ **Base de datos PostgreSQL** con relaciones optimizadas

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **Java 17+**
- **Spring Boot 3.5.3**
- **Spring Data JPA**
- **PostgreSQL 17+**
- **Maven 3.6+**
- **Hibernate 6.6+**
- **Jackson** para serializaci√≥n JSON
- **SLF4J + Logback** para logging
- **HikariCP** para pool de conexiones

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

\`\`\`bash
# Verificar Java
java -version  # Debe ser 17 o superior

# Verificar Maven
mvn -version   # Debe ser 3.6 o superior

# Verificar PostgreSQL
psql --version # Debe ser 12 o superior
\`\`\`

### 1. Configurar Base de Datos

\`\`\`bash
# Crear base de datos
psql -U postgres -f scripts/01-crear-bd.sql

# Crear tablas principales
psql -U postgres -d instrumentosdb -f scripts/02-crear-tablas.sql

# Insertar datos iniciales
psql -U postgres -d instrumentosdb -f scripts/03-insertar-datos-json.sql
psql -U postgres -d instrumentosdb -f scripts/04-datos-adicionales.sql

# Crear tablas de pedidos
psql -U postgres -d instrumentosdb -f scripts/09-datos-prueba-pedidos-final.sql

# Verificar instalaci√≥n
psql -U postgres -d instrumentosdb -f scripts/10-verificar-todo.sql
\`\`\`

### 2. Configurar Aplicaci√≥n

\`\`\`bash
# Clonar repositorio
git clone <url-del-repositorio>
cd instrumentos-back-spring

# Configurar application.properties
# Las credenciales por defecto son:
# - Usuario: postgres
# - Contrase√±a: postgres (cambiar seg√∫n tu configuraci√≥n)
# - Puerto: 5432
# - Base de datos: instrumentosdb
# - Puerto del servidor: 3001
\`\`\`

### 3. Compilar y Ejecutar

\`\`\`bash
# Compilar proyecto
mvn clean compile

# Ejecutar aplicaci√≥n
mvn spring-boot:run

# O ejecutar JAR compilado
mvn clean package
java -jar target/instrumentos-back-spring-1.0.0.jar
\`\`\`

### 4. Verificar Funcionamiento

\`\`\`bash
# Probar endpoint b√°sico
curl http://localhost:3001/api/instrumentos

# Ejecutar tests completos
bash test-api-completo.sh
\`\`\`

## üì° Endpoints de la API

### Base URL
\`\`\`
http://localhost:3001/api
\`\`\`

### üé∏ Instrumentos

| M√©todo | Endpoint | Descripci√≥n | Implementado |
|--------|----------|-------------|--------------|
| GET | `/instrumentos` | Obtener todos los instrumentos | ‚úÖ |
| GET | `/instrumentos?paginated=true&page=0&size=10&sortBy=precio&sortDir=desc` | Obtener con paginaci√≥n y ordenamiento | ‚úÖ |
| GET | `/instrumentos/{id}` | Obtener instrumento por ID | ‚úÖ |
| POST | `/instrumentos` | Crear nuevo instrumento | ‚úÖ |
| PUT | `/instrumentos/{id}` | Actualizar instrumento | ‚úÖ |
| DELETE | `/instrumentos/{id}` | Eliminar instrumento | ‚úÖ |
| GET | `/instrumentos/categoria/{categoriaId}` | Filtrar por categor√≠a | ‚úÖ |
| GET | `/instrumentos/buscar?nombre={nombre}` | Buscar por nombre | ‚úÖ |

### üóÇÔ∏è Categor√≠as

| M√©todo | Endpoint | Descripci√≥n | Implementado |
|--------|----------|-------------|--------------|
| GET | `/categorias` | Obtener todas las categor√≠as | ‚úÖ |
| GET | `/categorias/{id}` | Obtener categor√≠a por ID | ‚úÖ |
| POST | `/categorias` | Crear nueva categor√≠a | ‚úÖ |
| PUT | `/categorias/{id}` | Actualizar categor√≠a | ‚úÖ |
| DELETE | `/categorias/{id}` | Eliminar categor√≠a | ‚úÖ |

### üõí Pedidos

| M√©todo | Endpoint | Descripci√≥n | Implementado |
|--------|----------|-------------|--------------|
| GET | `/pedidos` | Obtener todos los pedidos | ‚úÖ |
| GET | `/pedidos/{id}` | Obtener pedido por ID | ‚úÖ |
| POST | `/pedidos` | Crear nuevo pedido | ‚úÖ |
| DELETE | `/pedidos/{id}` | Eliminar pedido | ‚úÖ |
| GET | `/pedidos/fecha?fecha={yyyy-MM-dd}` | Buscar pedidos por fecha | ‚úÖ |

### üñºÔ∏è Im√°genes

| M√©todo | Endpoint | Descripci√≥n | Implementado |
|--------|----------|-------------|--------------|
| POST | `/images/upload/{instrumentoId}` | Subir imagen | ‚úÖ |
| GET | `/images/{filename}` | Obtener archivo de imagen | ‚úÖ |
| GET | `/images/instrumento/{instrumentoId}` | Obtener im√°genes de instrumento | ‚úÖ |
| GET | `/images/instrumento/{instrumentoId}/primary` | Obtener imagen principal | ‚úÖ |
| PUT | `/images/{imageId}/primary` | Establecer como principal | ‚úÖ |
| DELETE | `/images/{imageId}` | Eliminar imagen | ‚úÖ |

## üìù Ejemplos de Uso

### Crear Instrumento

\`\`\`bash
curl -X POST "http://localhost:3001/api/instrumentos" \
  -H "Content-Type: application/json" \
  -d '{
    "instrumento": "Guitarra Ac√∫stica Yamaha",
    "marca": "Yamaha",
    "modelo": "FG800",
    "precio": 15000.00,
    "costoEnvio": "G",
    "cantidadVendida": 0,
    "descripcion": "Guitarra ac√∫stica ideal para principiantes",
    "idCategoria": 1
  }'
\`\`\`

### Crear Pedido

\`\`\`bash
curl -X POST "http://localhost:3001/api/pedidos" \
  -H "Content-Type: application/json" \
  -d '{
    "instrumentos": [
      {
        "instrumentoId": 1,
        "cantidad": 2
      },
      {
        "instrumentoId": 3,
        "cantidad": 1
      }
    ]
  }'
\`\`\`

### Subir Imagen

\`\`\`bash
curl -X POST "http://localhost:3001/api/images/upload/1" \
  -F "file=@guitarra.jpg" \
  -F "altText=Guitarra Yamaha FG800" \
  -F "isPrimary=true"
\`\`\`

### B√∫squedas y Filtros

\`\`\`bash
# Buscar por nombre
curl "http://localhost:3001/api/instrumentos/buscar?nombre=guitarra"

# Filtrar por categor√≠a
curl "http://localhost:3001/api/instrumentos/categoria/1"

# Obtener con paginaci√≥n y ordenamiento
curl "http://localhost:3001/api/instrumentos?paginated=true&page=0&size=5&sortBy=precio&sortDir=desc"

# Buscar pedidos por fecha
curl "http://localhost:3001/api/pedidos/fecha?fecha=2024-01-15"
\`\`\`

### Par√°metros de Paginaci√≥n

\`\`\`bash
# Par√°metros disponibles para /instrumentos:
# - paginated: true/false (default: false)
# - page: n√∫mero de p√°gina (default: 0)
# - size: elementos por p√°gina (default: 10)
# - sortBy: campo para ordenar (default: "id")
# - sortDir: direcci√≥n del orden "asc"/"desc" (default: "asc")

# Ejemplo completo:
curl "http://localhost:3001/api/instrumentos?paginated=true&page=1&size=5&sortBy=precio&sortDir=desc"
\`\`\`

## üóÑÔ∏è Estructura de Base de Datos

### Tabla: categoria_instrumento
\`\`\`sql
CREATE TABLE categoria_instrumento (
    id BIGSERIAL PRIMARY KEY,
    denominacion VARCHAR(100) NOT NULL UNIQUE
);
\`\`\`

### Tabla: instrumento
\`\`\`sql
CREATE TABLE instrumento (
    id BIGSERIAL PRIMARY KEY,
    instrumento VARCHAR(255) NOT NULL,
    marca VARCHAR(100) NOT NULL,
    modelo VARCHAR(100) NOT NULL,
    imagen VARCHAR(255) DEFAULT '',
    precio DECIMAL(10,2) NOT NULL,
    costo_envio VARCHAR(10) DEFAULT '0',
    cantidadvendida INTEGER DEFAULT 0,
    descripcion TEXT DEFAULT '',
    id_categoria BIGINT,
    cantidad_vendida INTEGER DEFAULT 0,
    FOREIGN KEY (id_categoria) REFERENCES categoria_instrumento(id)
);
\`\`\`

### Tabla: pedido
\`\`\`sql
CREATE TABLE pedido (
    id BIGSERIAL PRIMARY KEY,
    fecha_pedido DATE NOT NULL,
    total_pedido DECIMAL(10,2) NOT NULL
);
\`\`\`

### Tabla: pedido_detalle
\`\`\`sql
CREATE TABLE pedido_detalle (
    id BIGSERIAL PRIMARY KEY,
    pedido_id BIGINT NOT NULL,
    instrumento_id BIGINT NOT NULL,
    cantidad INTEGER NOT NULL,
    FOREIGN KEY (pedido_id) REFERENCES pedido(id) ON DELETE CASCADE,
    FOREIGN KEY (instrumento_id) REFERENCES instrumento(id) ON DELETE CASCADE
);
\`\`\`

### Tabla: product_images
\`\`\`sql
CREATE TABLE product_images (
    id BIGSERIAL PRIMARY KEY,
    instrumento_id BIGINT NOT NULL,
    image_url VARCHAR(500) NOT NULL,
    alt_text VARCHAR(255),
    is_primary BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (instrumento_id) REFERENCES instrumento(id) ON DELETE CASCADE
);
\`\`\`

## üìä Formato de Respuestas

### Respuesta Exitosa (Lista Simple)
\`\`\`json
{
  "success": true,
  "message": "Instrumentos obtenidos exitosamente",
  "data": [
    {
      "id": 1,
      "instrumento": "Guitarra Ac√∫stica",
      "marca": "Yamaha",
      "modelo": "FG800",
      "precio": 15000.00,
      "costoEnvio": "G",
      "cantidadVendida": 5,
      "descripcion": "Guitarra ac√∫stica ideal para principiantes",
      "categoriaDenominacion": "Cuerda",
      "imagenes": []
    }
  ]
}
\`\`\`

### Respuesta Paginada
\`\`\`json
{
  "content": [
    {
      "id": 1,
      "instrumento": "Guitarra Ac√∫stica",
      "marca": "Yamaha",
      "precio": 15000.00,
      "categoriaDenominacion": "Cuerda"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": true,
      "ascending": false
    }
  },
  "totalElements": 25,
  "totalPages": 3,
  "first": true,
  "last": false,
  "numberOfElements": 10
}
\`\`\`

### Respuesta de Pedido
\`\`\`json
{
  "success": true,
  "message": "Pedido creado exitosamente",
  "data": {
    "id": 1,
    "fechaPedido": "2024-01-15",
    "totalPedido": 45000.00,
    "detalles": [
      {
        "id": 1,
        "instrumentoId": 1,
        "cantidad": 2,
        "instrumento": "Guitarra Ac√∫stica Yamaha"
      }
    ]
  }
}
\`\`\`

### Respuesta de Error
\`\`\`json
{
  "success": false,
  "message": "Descripci√≥n del error",
  "data": null
}
\`\`\`

## üß™ Testing Completo

### Ejecutar Tests Automatizados
\`\`\`bash
# Ejecutar script de testing completo
bash test-api-completo.sh

# Tests incluidos:
# ‚úÖ CRUD de categor√≠as (5 tests)
# ‚úÖ CRUD de instrumentos (8 tests)
# ‚úÖ CRUD de pedidos (5 tests)
# ‚úÖ Sistema de im√°genes (4 tests)
# ‚úÖ Validaciones y errores (4 tests)
# ‚úÖ Limpieza de datos (5 tests)
# ‚úÖ Total: 31 tests completos
\`\`\`

### Cobertura de Testing
- **Funcionalidad b√°sica**: CRUD completo de todas las entidades
- **Relaciones**: Validaci√≥n de foreign keys y cascadas
- **Paginaci√≥n**: Tests de paginaci√≥n y ordenamiento
- **B√∫squeda**: Tests de filtrado y b√∫squeda
- **Validaciones**: Tests de datos inv√°lidos y duplicados
- **Manejo de errores**: Tests de c√≥digos HTTP apropiados
- **Limpieza**: Eliminaci√≥n autom√°tica de datos de prueba

## üìÅ Estructura del Proyecto

\`\`\`
src/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ java/com/instrumentos/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/          # Configuraciones (CORS, Web)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebConfig.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/      # Controladores REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaController.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InstrumentoController.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoController.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImageController.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HomeController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/            # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InstrumentoDTO.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoDTO.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoDetalleDTO.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CrearPedidoRequest.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ItemCarritoDTO.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductImageDTO.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ApiResponse.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception/      # Manejo de excepciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/          # Entidades JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Instrumento.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Categoria.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pedido.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoDetalle.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductImage.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/     # Repositorios JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InstrumentoRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoDetalleRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductImageRepository.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/        # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InstrumentoService.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaService.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PedidoService.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductImageService.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InstrumentosSandovalApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ       ‚îú‚îÄ‚îÄ application.properties
‚îÇ       ‚îî‚îÄ‚îÄ static/images/  # Directorio de im√°genes
‚îú‚îÄ‚îÄ test/                   # Tests unitarios
‚îú‚îÄ‚îÄ scripts/               # Scripts SQL
‚îÇ   ‚îú‚îÄ‚îÄ 01-crear-bd.sql
‚îÇ   ‚îú‚îÄ‚îÄ 02-crear-tablas.sql
‚îÇ   ‚îú‚îÄ‚îÄ 03-insertar-datos-json.sql
‚îÇ   ‚îú‚îÄ‚îÄ 04-datos-adicionales.sql
‚îÇ   ‚îú‚îÄ‚îÄ 05-verificar-datos.sql
‚îÇ   ‚îú‚îÄ‚îÄ 09-datos-prueba-pedidos-final.sql
‚îÇ   ‚îî‚îÄ‚îÄ 10-verificar-todo.sql
‚îú‚îÄ‚îÄ public/images/         # Directorio p√∫blico de im√°genes
‚îú‚îÄ‚îÄ test-api-completo.sh   # Script de testing completo
‚îî‚îÄ‚îÄ target/               # Archivos compilados
\`\`\`

## üîß Configuraci√≥n

### application.properties
\`\`\`properties
# Base de datos PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/instrumentosdb
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Servidor - Puerto 3001
server.port=3001

# Logging
logging.level.com.instrumentos=DEBUG
logging.level.org.springframework.web=DEBUG

# Archivos
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
\`\`\`

## üö® Notas Importantes

1. **Puerto del servidor**: La aplicaci√≥n corre en el puerto **3001** para evitar conflictos
2. **Base de datos**: Requiere PostgreSQL con la base de datos `instrumentosdb`
3. **Im√°genes**: Se almacenan en `public/images/` y `src/main/resources/static/images/`
4. **CORS**: Configurado para permitir localhost en cualquier puerto
5. **Paginaci√≥n**: Solo disponible para instrumentos con el par√°metro `paginated=true`
6. **Validaciones**: Todos los endpoints validan datos de entrada
7. **Transacciones**: Los pedidos se crean de forma transaccional
8. **Cascadas**: Eliminar un pedido elimina autom√°ticamente sus detalles

## üéØ Pr√≥ximos Pasos Sugeridos

1. **Frontend**: Implementar interfaz de usuario con React/Angular/Vue
2. **Autenticaci√≥n**: Agregar JWT para seguridad
3. **Cache**: Implementar Redis para mejorar rendimiento
4. **Documentaci√≥n**: Agregar Swagger/OpenAPI
5. **Tests**: Ampliar cobertura de tests unitarios
6. **Docker**: Containerizar la aplicaci√≥n
7. **CI/CD**: Configurar pipeline de despliegue

---

**Desarrollado por:** Agust√≠n Sandoval  
**Instituci√≥n:** Universidad Tecnol√≥gica Nacional - Facultad Regional Mendoza  
**Carrera:** Tecnicatura Universitaria en Programaci√≥n  
**Materia:** Laboratorio de Computaci√≥n 4  
**A√±o:** 2025
---